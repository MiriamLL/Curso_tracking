<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Editar GPS</title>
    <meta charset="utf-8" />
    <meta name="author" content="Miriam Lerma" />
    <script src="Parte3_files/header-attrs-2.6/header-attrs.js"></script>
    <link rel="stylesheet" href="Curso_tracking.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">


class: title-slide, inverse, middle, right
background-image: url(https://raw.githubusercontent.com/MiriamLL/Curso_tracking/main/03Figuras/PortadaC.jpg)
background-size: cover



class: title-slide, inverse, middle, right

&lt;h1&gt;&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#264653;" viewBox="0 0 448 512"&gt;&lt;path d="M278.06 256L444.48 89.57c4.69-4.69 4.69-12.29 0-16.97-32.8-32.8-85.99-32.8-118.79 0L210.18 188.12l-24.86-24.86c4.31-10.92 6.68-22.81 6.68-35.26 0-53.02-42.98-96-96-96S0 74.98 0 128s42.98 96 96 96c4.54 0 8.99-.32 13.36-.93L142.29 256l-32.93 32.93c-4.37-.61-8.83-.93-13.36-.93-53.02 0-96 42.98-96 96s42.98 96 96 96 96-42.98 96-96c0-12.45-2.37-24.34-6.68-35.26l24.86-24.86L325.69 439.4c32.8 32.8 85.99 32.8 118.79 0 4.69-4.68 4.69-12.28 0-16.97L278.06 256zM96 160c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32zm0 256c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32z"/&gt;&lt;/svg&gt; &lt;svg style="height:0.8em;top:.04em;position:relative;fill:#203C46;" viewBox="0 0 448 512"&gt;&lt;path d="M278.06 256L444.48 89.57c4.69-4.69 4.69-12.29 0-16.97-32.8-32.8-85.99-32.8-118.79 0L210.18 188.12l-24.86-24.86c4.31-10.92 6.68-22.81 6.68-35.26 0-53.02-42.98-96-96-96S0 74.98 0 128s42.98 96 96 96c4.54 0 8.99-.32 13.36-.93L142.29 256l-32.93 32.93c-4.37-.61-8.83-.93-13.36-.93-53.02 0-96 42.98-96 96s42.98 96 96 96 96-42.98 96-96c0-12.45-2.37-24.34-6.68-35.26l24.86-24.86L325.69 439.4c32.8 32.8 85.99 32.8 118.79 0 4.69-4.68 4.69-12.28 0-16.97L278.06 256zM96 160c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32zm0 256c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32z"/&gt;&lt;/svg&gt; &lt;svg style="height:0.8em;top:.04em;position:relative;fill:#2D5462;" viewBox="0 0 448 512"&gt;&lt;path d="M278.06 256L444.48 89.57c4.69-4.69 4.69-12.29 0-16.97-32.8-32.8-85.99-32.8-118.79 0L210.18 188.12l-24.86-24.86c4.31-10.92 6.68-22.81 6.68-35.26 0-53.02-42.98-96-96-96S0 74.98 0 128s42.98 96 96 96c4.54 0 8.99-.32 13.36-.93L142.29 256l-32.93 32.93c-4.37-.61-8.83-.93-13.36-.93-53.02 0-96 42.98-96 96s42.98 96 96 96 96-42.98 96-96c0-12.45-2.37-24.34-6.68-35.26l24.86-24.86L325.69 439.4c32.8 32.8 85.99 32.8 118.79 0 4.69-4.68 4.69-12.28 0-16.97L278.06 256zM96 160c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32zm0 256c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32z"/&gt;&lt;/svg&gt; &lt;svg style="height:0.8em;top:.04em;position:relative;fill:#3A6C7E;" viewBox="0 0 448 512"&gt;&lt;path d="M278.06 256L444.48 89.57c4.69-4.69 4.69-12.29 0-16.97-32.8-32.8-85.99-32.8-118.79 0L210.18 188.12l-24.86-24.86c4.31-10.92 6.68-22.81 6.68-35.26 0-53.02-42.98-96-96-96S0 74.98 0 128s42.98 96 96 96c4.54 0 8.99-.32 13.36-.93L142.29 256l-32.93 32.93c-4.37-.61-8.83-.93-13.36-.93-53.02 0-96 42.98-96 96s42.98 96 96 96 96-42.98 96-96c0-12.45-2.37-24.34-6.68-35.26l24.86-24.86L325.69 439.4c32.8 32.8 85.99 32.8 118.79 0 4.69-4.68 4.69-12.28 0-16.97L278.06 256zM96 160c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32zm0 256c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32z"/&gt;&lt;/svg&gt; &lt;svg style="height:0.8em;top:.04em;position:relative;fill:#4D90A8;" viewBox="0 0 448 512"&gt;&lt;path d="M278.06 256L444.48 89.57c4.69-4.69 4.69-12.29 0-16.97-32.8-32.8-85.99-32.8-118.79 0L210.18 188.12l-24.86-24.86c4.31-10.92 6.68-22.81 6.68-35.26 0-53.02-42.98-96-96-96S0 74.98 0 128s42.98 96 96 96c4.54 0 8.99-.32 13.36-.93L142.29 256l-32.93 32.93c-4.37-.61-8.83-.93-13.36-.93-53.02 0-96 42.98-96 96s42.98 96 96 96 96-42.98 96-96c0-12.45-2.37-24.34-6.68-35.26l24.86-24.86L325.69 439.4c32.8 32.8 85.99 32.8 118.79 0 4.69-4.68 4.69-12.28 0-16.97L278.06 256zM96 160c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32zm0 256c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32z"/&gt;&lt;/svg&gt; 

# Editar&lt;br&gt;GPS

## **Miriam Lerma**&lt;br&gt;
Abril 2021

&lt;h1&gt;&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#264653;" viewBox="0 0 448 512"&gt;&lt;path d="M278.06 256L444.48 89.57c4.69-4.69 4.69-12.29 0-16.97-32.8-32.8-85.99-32.8-118.79 0L210.18 188.12l-24.86-24.86c4.31-10.92 6.68-22.81 6.68-35.26 0-53.02-42.98-96-96-96S0 74.98 0 128s42.98 96 96 96c4.54 0 8.99-.32 13.36-.93L142.29 256l-32.93 32.93c-4.37-.61-8.83-.93-13.36-.93-53.02 0-96 42.98-96 96s42.98 96 96 96 96-42.98 96-96c0-12.45-2.37-24.34-6.68-35.26l24.86-24.86L325.69 439.4c32.8 32.8 85.99 32.8 118.79 0 4.69-4.68 4.69-12.28 0-16.97L278.06 256zM96 160c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32zm0 256c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32z"/&gt;&lt;/svg&gt; &lt;svg style="height:0.8em;top:.04em;position:relative;fill:#203C46;" viewBox="0 0 448 512"&gt;&lt;path d="M278.06 256L444.48 89.57c4.69-4.69 4.69-12.29 0-16.97-32.8-32.8-85.99-32.8-118.79 0L210.18 188.12l-24.86-24.86c4.31-10.92 6.68-22.81 6.68-35.26 0-53.02-42.98-96-96-96S0 74.98 0 128s42.98 96 96 96c4.54 0 8.99-.32 13.36-.93L142.29 256l-32.93 32.93c-4.37-.61-8.83-.93-13.36-.93-53.02 0-96 42.98-96 96s42.98 96 96 96 96-42.98 96-96c0-12.45-2.37-24.34-6.68-35.26l24.86-24.86L325.69 439.4c32.8 32.8 85.99 32.8 118.79 0 4.69-4.68 4.69-12.28 0-16.97L278.06 256zM96 160c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32zm0 256c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32z"/&gt;&lt;/svg&gt; &lt;svg style="height:0.8em;top:.04em;position:relative;fill:#2D5462;" viewBox="0 0 448 512"&gt;&lt;path d="M278.06 256L444.48 89.57c4.69-4.69 4.69-12.29 0-16.97-32.8-32.8-85.99-32.8-118.79 0L210.18 188.12l-24.86-24.86c4.31-10.92 6.68-22.81 6.68-35.26 0-53.02-42.98-96-96-96S0 74.98 0 128s42.98 96 96 96c4.54 0 8.99-.32 13.36-.93L142.29 256l-32.93 32.93c-4.37-.61-8.83-.93-13.36-.93-53.02 0-96 42.98-96 96s42.98 96 96 96 96-42.98 96-96c0-12.45-2.37-24.34-6.68-35.26l24.86-24.86L325.69 439.4c32.8 32.8 85.99 32.8 118.79 0 4.69-4.68 4.69-12.28 0-16.97L278.06 256zM96 160c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32zm0 256c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32z"/&gt;&lt;/svg&gt; &lt;svg style="height:0.8em;top:.04em;position:relative;fill:#3A6C7E;" viewBox="0 0 448 512"&gt;&lt;path d="M278.06 256L444.48 89.57c4.69-4.69 4.69-12.29 0-16.97-32.8-32.8-85.99-32.8-118.79 0L210.18 188.12l-24.86-24.86c4.31-10.92 6.68-22.81 6.68-35.26 0-53.02-42.98-96-96-96S0 74.98 0 128s42.98 96 96 96c4.54 0 8.99-.32 13.36-.93L142.29 256l-32.93 32.93c-4.37-.61-8.83-.93-13.36-.93-53.02 0-96 42.98-96 96s42.98 96 96 96 96-42.98 96-96c0-12.45-2.37-24.34-6.68-35.26l24.86-24.86L325.69 439.4c32.8 32.8 85.99 32.8 118.79 0 4.69-4.68 4.69-12.28 0-16.97L278.06 256zM96 160c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32zm0 256c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32z"/&gt;&lt;/svg&gt; &lt;svg style="height:0.8em;top:.04em;position:relative;fill:#4D90A8;" viewBox="0 0 448 512"&gt;&lt;path d="M278.06 256L444.48 89.57c4.69-4.69 4.69-12.29 0-16.97-32.8-32.8-85.99-32.8-118.79 0L210.18 188.12l-24.86-24.86c4.31-10.92 6.68-22.81 6.68-35.26 0-53.02-42.98-96-96-96S0 74.98 0 128s42.98 96 96 96c4.54 0 8.99-.32 13.36-.93L142.29 256l-32.93 32.93c-4.37-.61-8.83-.93-13.36-.93-53.02 0-96 42.98-96 96s42.98 96 96 96 96-42.98 96-96c0-12.45-2.37-24.34-6.68-35.26l24.86-24.86L325.69 439.4c32.8 32.8 85.99 32.8 118.79 0 4.69-4.68 4.69-12.28 0-16.97L278.06 256zM96 160c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32zm0 256c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32z"/&gt;&lt;/svg&gt; 

---

# Intro

En esta presentación verán como:
- [Cargar datos de GPS](#cargar) &lt;br&gt;
- Recortar periodos de [un solo individuo](#uno)&lt;br&gt;
[Usando paquete sula](#sula)&lt;br&gt;
[Convertir a formato dia y hora](#convertir)&lt;br&gt;
- Recortar periodos de [múltiples individuos](#varios)&lt;br&gt;
[Usando paquete sula](#sula2)&lt;br&gt;
[Usando función](#funcion)&lt;br&gt;
[Usando iteración](#funcion)&lt;br&gt;
- [Exportar datos](#exportar) &lt;br&gt;



--

## Ustedes

- Tienes una base de datos con datos de GPS &lt;br&gt;
- Tienen conocimientos básicos de R, si no te recomiendo [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#e63946;" viewBox="0 0 576 512"&gt;&lt;path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/&gt;&lt;/svg&gt;empezar por aquí](https://miriamlerma.netlify.app/posts/2021-03-01-introar/) &lt;br&gt;

---

# Motivación

- A menudo los GPS deben ser activados antes de colocarse, y son apagados tiempo después de ser recolectados. 
- Por eso es importante registrar la hora de inicio (cuando estaba en el animal) y cuando fue retirado. &lt;br&gt; 
- Con esta información podemos editar nuestros datos colectados de GPS para que correspondan solo al periodo en el que estuvo en el animal.

--

&lt;br&gt; 

Pero...
.center[
&lt;h1&gt;🙄&lt;/h1&gt;]

 .right[¿Como los recortamos?]


---

class:center,middle

&lt;h3&gt;&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#22577a;" viewBox="0 0 512 512"&gt;&lt;path d="M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"/&gt;&lt;/svg&gt;

## 1. Importar datos a R

Para esta parte necesitas saber cargar tus datos, si necesitas recordar como hacerlo, te recomiendo [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#e63946;" viewBox="0 0 576 512"&gt;&lt;path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/&gt;&lt;/svg&gt;empezar por aquí](https://miriamll.github.io/Curso_tracking/Parte1).

---
name: cargar

### 1.1. Cargar datos

Para cargar datos de prueba.&lt;br&gt;
Puedes instalar el paquete 'sula'

```r
remotes::install_github("MiriamLL/sula")
```

Cargar datos de un solo individuo

```r
library(sula)
GPS_01&lt;-GPS_01
```

Cargar datos de diez individuos

```r
library(sula)
GPS_diez&lt;-GPS_raw
```

---
name:uno
class:center,middle

&lt;h1&gt;&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#22577a;" viewBox="0 0 448 512"&gt;&lt;path d="M278.06 256L444.48 89.57c4.69-4.69 4.69-12.29 0-16.97-32.8-32.8-85.99-32.8-118.79 0L210.18 188.12l-24.86-24.86c4.31-10.92 6.68-22.81 6.68-35.26 0-53.02-42.98-96-96-96S0 74.98 0 128s42.98 96 96 96c4.54 0 8.99-.32 13.36-.93L142.29 256l-32.93 32.93c-4.37-.61-8.83-.93-13.36-.93-53.02 0-96 42.98-96 96s42.98 96 96 96 96-42.98 96-96c0-12.45-2.37-24.34-6.68-35.26l24.86-24.86L325.69 439.4c32.8 32.8 85.99 32.8 118.79 0 4.69-4.68 4.69-12.28 0-16.97L278.06 256zM96 160c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32zm0 256c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32z"/&gt;&lt;/svg&gt;

## 2. Recortar usando un solo individuo
Para esta parte tus datos deben ser transformados al formato POSIXct, si necesitas más información [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#e63946;" viewBox="0 0 576 512"&gt;&lt;path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/&gt;&lt;/svg&gt;ve aquí](https://miriamll.github.io/Curso_tracking/Parte2#1).

---
name: sula

### 2.1. Usando paquete sula.

Supongamos que queremos recortar periodos del track del GPS01 que se coloco a las 18:10:00 del 02/11/2017 y se retiro a las 14:10:00 el 05/11/2017.

Esta función te permite recortar periodos dentro de tus datos.

```r
GPS_recortado&lt;-recortar_periodo(GPS_data=GPS_01,
                                inicio='02/11/2017 18:10:00',
                                final='05/11/2017 14:10:00',
                                dia_col='DateGMT',
                                hora_col='TimeGMT',
                                formato="%d/%m/%Y %H:%M:%S")
```

```
## El track original contenia 1038 filas y el track editado contiene 986 filas
```

Te regresa un dataframe solo con los periodos de interés.

Listo!
.center[
&lt;h1&gt;🥳&lt;/h1&gt;
]

---
name: convertir

### 2.2. Convertir a formato día y hora

Si quieres hacerlo lo mismo pero paso a paso.

Para convertir a formato día y hora, debes unir las columnas de día y hora y usar el argumento POSIXct para que R entienda que son día y hora.

Unir columnas

```r
GPS_01$diahora&lt;-paste(GPS_01$DateGMT,GPS_01$TimeGMT)
```

Transformar formato

```r
GPS_01$diahora&lt;-as.POSIXct(strptime(GPS_01$diahora,
                                            "%d/%m/%Y %H:%M:%S"),"GMT")
```

---

### 2.2. Convertir a formato día y hora

Supongamos que queremos recortar periodos del track del GPS01 que se coloco a las 18:10:00 del 02/11/2017 y se retiro a las 14:10:00 el 05/11/2017.

Podemos escribir manualmente la hora de inicio y final. &lt;br&gt;

```r
Hora_inicio&lt;-'02/11/2017 18:10:00'
Hora_final&lt;-'05/11/2017 14:10:00'
```

Ambas horas se debe convertir a formato día y hora para que R entienda que son fecha y tiempo.&lt;br&gt;

```r
Hora_inicio&lt;-as.POSIXct(strptime(Hora_inicio, "%d/%m/%Y %H:%M:%S"), "GMT") 
Hora_final&lt;- as.POSIXct(strptime(Hora_final, "%d/%m/%Y %H:%M:%S"), "GMT") 
```

Aparecerán Hora_inicio y Hora_final en tu **environment** en la sección de **values**

---

### 2.3. Errores comunes

Presta mucho atención a como tienes ordenados tus datos.&lt;br&gt;
- Verifica si usas **/** o **-** para separar tus fechas, o que otro separador puede existir en tus datos.

Para el formato '21-12-2017 05:30:01'.

```r
format = "%d-%m-%Y %H:%M:%S"
```

Para el formato '2017/12/21 05:30:01'.

```r
format = "%Y/%m/%d %H:%M:%S"
```


---

### 2.4. Eliminar periodos dentro de nuestros datos

Paso a paso, para eliminar periodos dentro de nuestros datos.  
Se puede utilizar la función mutate de la libreria dplyr dentro de tidyverse, para agregar una columna con Y o N,  siendo **N** el periodo que queremos eliminar.  

```r
library(tidyverse)
```

No es necesario crear esa columna, pero es útil para verificar primero que funciono correctamente.    

```r
GPS_01&lt;-mutate(GPS_01,
              track = ifelse(GPS_01$diahora &gt;= Hora_inicio &amp; 
                                GPS_01$diahora &lt;= Hora_final, 
                                "Y","N"))
```
Ahora tendras en tu GPS_01 una nueva columna llamada track. 

---

### 2.4. Eliminar periodos dentro de nuestros datos

Usando información de la columna **track** se pueden filtrar para quedar solo con el periodo que interesa. 

**Opción 1**: usando la función **filter**

```r
GPS01_opcion1&lt;-GPS_01 %&gt;% filter(track=='Y')
```

**Opción 2**: usando la función **subset**

```r
GPS01_opcion2&lt;-subset(GPS_01,GPS_01$track=='Y')
```
Nota que el numero de observaciones se reduce y las dos opciones dan resultados idénticos.

.center[
&lt;h1&gt;🥳&lt;/h1&gt;
]

---
name: varios
class:center,middle

&lt;h1&gt;&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#22577a;" viewBox="0 0 576 512"&gt;&lt;path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"/&gt;&lt;/svg&gt;

# 3. Recortar multiples individuos
Como usar funciones para cortar periodos en nuestros datos de GPS cuando tenemos muchos individuos.

---


### 3.1. Datos de libreta

El paquete sula provee con datos de ejemplo de datos de libreta.  
Para usar las funciones te recomiendo tener los mismos nombres en las columnas.  

```r
library(sula)
Notas&lt;-Notas
head(Notas)
```

```
##     IDs         Hora_inicio          Hora_final
## 1 GPS01 03/11/2017 08:00:00 05/11/2017 14:00:00
## 2 GPS02 03/11/2017 09:00:00 05/11/2017 15:00:00
## 3 GPS03 03/11/2017 10:00:00 05/11/2017 16:00:00
## 4 GPS04 03/11/2017 11:00:00 05/11/2017 17:00:00
## 5 GPS05 03/11/2017 12:00:00 05/11/2017 18:00:00
## 6 GPS06 03/11/2017 13:00:00 05/11/2017 19:00:00
```

---
name: sula2
### 3.2. Usando paquete sula

Puedes recortar periodos en los viajes.  
Para el ejemplo hay que tener dos data frames:  
- **Datos de GPS** incluyendo las columnas 'DateGMT','TimeGMT' y 'IDs'.  
Si no tienen estos nombres favor de renombrarlas.  
- **Datos de campo** debe incluir las columnas 'IDs', 'Hora_inicio' y 'Hora_final'.  
Si no tienen esos nombres favor de renombrarlas.  


```r
GPS_recortados&lt;-recortar_por_ID(GPS_data=GPS_raw,
                                Notas=Notas,
                                formato="%d/%m/%Y %H:%M:%S")
```


```r
range(GPS_recortados$dia_hora)
```

```
## [1] "2017-11-03 08:02:18 GMT" "2017-11-26 22:59:56 GMT"
```

Listo!
.center[
&lt;h1&gt;🥳&lt;/h1&gt;
]

---
name: funcion
### 3.3. Basicos de una función

También se puede hacer lo mismo, pero paso a paso usando una función.  
Una función nos permite ahorrarnos el tiempo de escribir todos los pasos.

Para crear una función se usa el argumento **function** y corchetes.

```r
Nombre_de_la_funcion&lt;-function(){}
```
.right[...pero no entrare en detalles.&lt;br&gt;

Si quieres aprender más sobre funciones [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#e63946;" viewBox="0 0 576 512"&gt;&lt;path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/&gt;&lt;/svg&gt; ve aqui](https://es.r4ds.hadley.nz/funciones.html)]

---

### 3.3. Función

Si no quieres crear tu propia función, usa la siguiente función pero asegúrate de tener:
1. Un data frame con tus datos de GPS con cinco columnas siendo la 5ta IDs y una columna **diahora** (en POSIXct).
2. Un data frame con tus datos de campo con el nombre **Notas** que contenga tres columnas (IDs, Hora_inicio y Hora_final).

```r
cortar_viaje&lt;-function(GPS_id=GPS_id){
  Nombre&lt;-as.character(GPS_id[1,5]) #5ta columna es IDs
  Horas&lt;-subset(Notas,Notas$IDs==Nombre)
  Hora_inicio&lt;-Horas[1,2] #2nda columna es Hora_inicio
  Hora_final&lt;-Horas[1,3]  #3era columna es Hora_final
  Hora_inicio&lt;- as.POSIXct(strptime(Hora_inicio, "%d/%m/%Y %H:%M:%S"), tz='GMT') 
  Hora_final&lt;- as.POSIXct(strptime(Hora_final, "%d/%m/%Y %H:%M:%S"), tz='GMT') 
  GPS_recortado&lt;-mutate(GPS_id,track=ifelse(GPS_id$diahora&gt;=Hora_inicio &amp; #columna diahora
                                              GPS_id$diahora&lt;=Hora_final,"Y","N"))#columna diahora
  GPS_recortado&lt;-GPS_recortado %&gt;% filter(track=='Y')
  assign(paste0(Nombre,"_recortado"),GPS_recortado,envir=.GlobalEnv)}
```
Cuando cargas tu función te aparece el el **environment** en la parte de **Functions**


---

### 3.4. cortar_viaje

**Nota** Recuerda cambiar tus datos a formato fecha y hora.

```r
GPS_raw$diahora&lt;-paste(GPS_raw$DateGMT,GPS_raw$TimeGMT)
GPS_raw$diahora&lt;-as.POSIXct(strptime(GPS_raw$diahora, "%d/%m/%Y %H:%M:%S"),  "GMT")
```

Y cargar la libreria

```r
library(dplyr)
```

En la dispositiva anterior creamos una funcion que se llama **cortar_viaje**. &lt;br&gt;
Para que haga algo hay que darle argumentos.  
Por ejemplo, el nombre del objeto GPS01.

```r
cortar_viaje(GPS_01)
```
Al final la función agrega un nuevo objeto a tu environment con el nombre del GPS y "_recortado". En este caso creara **GPS01_recortado**

---

### 3.4. cortar_viaje

Listo!

```r
range(GPS01_recortado$diahora)
```

```
## [1] "2017-11-03 08:02:18 GMT" "2017-11-05 13:56:13 GMT"
```

También se puede usar:

```r
cortar_viaje(subset(GPS_raw,GPS_raw$IDs=='GPS02'))
```
Las dos opciones funcionan.


```r
range(GPS02_recortado$diahora)
```

```
## [1] "2017-11-03 09:02:57 GMT" "2017-11-05 14:57:40 GMT"
```

.center[
&lt;h1&gt;🥳&lt;/h1&gt;
]

---

name: iteraciones

class:center,middle

&lt;h1&gt;&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#22577a;" viewBox="0 0 576 512"&gt;&lt;path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"/&gt;&lt;/svg&gt;

# 4. Iteraciones
Como usar iteraciones cortar periodos en nuestros datos de GPS cuando tenemos muchos individuos en una lista.
Si quieres aprender más sobre iteraciones [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#e63946;" viewBox="0 0 576 512"&gt;&lt;path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/&gt;&lt;/svg&gt; ve aquí](https://r4ds.had.co.nz/iteration.html)

---

## 4.1. Listas

Para hacer una iteración con los datos, lo primero es recordar que los datos deben estar en formato día y hora

```r
GPS_raw$diahora&lt;-paste(GPS_raw$DateGMT,
                              GPS_raw$TimeGMT)

GPS_raw$diahora&lt;-as.POSIXct(strptime(GPS_raw$diahora,
                                            "%d/%m/%Y %H:%M:%S"),"GMT")
```

Posteriormente, hay que crear una lista usando como referencia el ID.

```r
Lista_GPS&lt;-split(GPS_raw,GPS_raw$IDs)
```
Ahora aparecerá en tu **environment** Lista_GPS, y este objeto es una **Large list**. 

Podemos acceder a elementos individuales de esta lista.
Por ejemplo:

```r
GPS_01&lt;-Lista_GPS[[1]]
```

---

## 4.2. Aplicar

Pero para no hacer individuo por individuo, podemos hacer una **iteracion** que se aplique a todos los elementos de la lista

Si quieres usar esta **iteración**, solo asegurate de 
- Tener una lista con los datos de tus GPS que contenga una columna IDs y **diahora** en formato POSIXct
- Tener una objeto llamado **Notas** con IDs, Hora_inicio y Hora_final

```r
for( i in seq_along(Lista_GPS)){
  GPS_id&lt;-Lista_GPS[[i]]
  Nombre&lt;-as.character(GPS_id[1,5]) #columa IDs
  Horas&lt;-subset(Notas,Notas$IDs==Nombre) #Notas
  Hora_inicio&lt;- as.POSIXct(strptime(Horas[1,2], "%d/%m/%Y %H:%M:%S"), tz='GMT') 
  Hora_final&lt;- as.POSIXct(strptime(Horas[1,3], "%d/%m/%Y %H:%M:%S"), tz='GMT') 
  Lista_GPS[[i]]&lt;-dplyr::mutate(GPS_id,track= ifelse(GPS_id$diahora&gt;=Hora_inicio &amp; #diahora
                                    GPS_id$diahora&lt;=Hora_final,"Y","N")) 
  }
```

---

## 4.3. Data frame

Puedes volver a pegar los elementos de tu lista en un data frame.

```r
GPS_df&lt;- do.call("rbind",Lista_GPS)
```

Y quedarte solo con los periodos que te interesan.

```r
GPS_recortados&lt;-GPS_df %&gt;% filter(track=='Y')
```

Listo!
.center[
&lt;h1&gt;🥳&lt;/h1&gt;
]

---
name: exportar

class: center, middle

&lt;h1&gt;&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#22577a;" viewBox="0 0 576 512"&gt;&lt;path d="M384 121.9c0-6.3-2.5-12.4-7-16.9L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128zM571 308l-95.7-96.4c-10.1-10.1-27.4-3-27.4 11.3V288h-64v64h64v65.2c0 14.3 17.3 21.4 27.4 11.3L571 332c6.6-6.6 6.6-17.4 0-24zm-379 28v-32c0-8.8 7.2-16 16-16h176V160H248c-13.2 0-24-10.8-24-24V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V352H208c-8.8 0-16-7.2-16-16z"/&gt;&lt;/svg&gt;

# 5. Exportar 
Para esta parte necesitas saber exportar tus datos, si necesitas recordar como hacerlo, te recomiendo [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#e63946;" viewBox="0 0 576 512"&gt;&lt;path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/&gt;&lt;/svg&gt;empezar por aquí](https://miriamll.github.io/Curso_CIAD/Clase3Parte2#54).

---

### 5.1. Comparar

Si quieres comparar los cambios y ver si todo funcionó. Usa table para ver el numero de observaciones.Si tenemos menos observaciones que en el archivo original. Eso significa que logramos cortar periodos en los tracks de manera **exitosa**.

Datos originales

```r
table(GPS_raw$IDs)
```

```

GPS01 GPS02 GPS03 GPS04 GPS05 GPS06 GPS07 GPS08 GPS09 GPS10 
 1038  1049  1246  1031   962  1231  1004  1015   931   933 
```

Datos recortados

```r
table(GPS_recortados$IDs)
```

```

GPS01 GPS02 GPS03 GPS04 GPS05 GPS06 GPS07 GPS08 GPS09 GPS10 
  783   787   784   775   698   771   436   436   436   437 
```

.center[
&lt;h1&gt;🥳&lt;/h1&gt;
]

---

### 5.2. Exportar 

De acuerdo a lo que quieras hacer, puedes exportar los GPS de manera individual

```r
GPS_01
```

O puedes exportar todos los GPS recortados

```r
GPS_recortados
```

Seleccionar la carpeta.

```r
library(here)
```

```
## here() starts at C:/Users/Lerma/Documents/4Cursos/1Bobos/ClaseTracking/Curso_tracking
```

```r
DatosFolder&lt;-here::here("01Datos")
```

Seleccionar archivo y el nombre de tu nuevo data frame.  

```r
write_csv(
  GPS_recortados,
  file=paste0(DatosFolder,'/GPS_recortados.csv'))
```


---

## 6. Contacto

Recapitulando: 
- [Cargar datos de GPS](#cargar) &lt;br&gt;
- Recortar periodos de [un solo individuo](#uno)&lt;br&gt;
[Usando paquete sula](#sula)&lt;br&gt;
[Convertir a formato dia y hora](#convertir)&lt;br&gt;
- Recortar periodos de [múltiples individuos](#varios)&lt;br&gt;
[Usando paquete sula](#sula2)&lt;br&gt;
[Usando función](#funcion)&lt;br&gt;
[Usando iteración](#funcion)&lt;br&gt;
- [Exportar datos](#exportar) &lt;br&gt;

.right[Para dudas, comentarios y sugerencias:  
Escríbeme a miriamjlerma@gmail.com]

Si quieres dar créditos puedes usar:
- Lerma M (2021) Package sula. Zenodo. http://doi.org/10.5281/zenodo.4682898
- Lerma M, Dehnhard N, Luna-Jorquera G, Voigt CC, Garthe S (2020) Breeding stage, not sex, affects foraging characteristics in masked boobies at Rapa Nui. Behavioral ecology and sociobiology 74: 149 [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#e63946;" viewBox="0 0 576 512"&gt;&lt;path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/&gt;&lt;/svg&gt;OpenAccess](https://link.springer.com/article/10.1007/s00265-020-02921-1)&lt;br&gt;
Los datos de prueba vienen de esa publicación. 

.center[

&lt;h3&gt;&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#e63946;" viewBox="0 0 576 512"&gt;&lt;path d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"/&gt;&lt;/svg&gt;[Volver ](https://miriamlerma.netlify.app/posts/2021-03-16-biologging/)
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
