---
title: "Parte 1"
subtitle: "Importar datos de GPS<br>"
author: "Miriam Lerma"
date: "Marzo 2021"
output:
  xaringan::moon_reader:
    css: ["default"]
    seal: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: true
      
---

```{r include = FALSE}
#Paquetes
library(xaringanExtra)
```

class: title-slide, inverse, middle, right
background-image: url(https://images.unsplash.com/photo-1473163928189-364b2c4e1135?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80)
background-size: cover

### `r rmarkdown::metadata$title`
# `r rmarkdown::metadata$subtitle`

**`r rmarkdown::metadata$author`**<br>
`r rmarkdown::metadata$date`

---

# Intro

En esta presentación verán como:
- Importar datos a R
- Eliminar periodos dentro de nuestros datos
- Graficar trayectorias
- Exportar nuestro nuevo data frame

```{r, echo=FALSE,include=FALSE, message=FALSE}
library(emo)
library(here)
library(fontawesome)
library(ggplot2)
```

--

## Ustedes

- Quieren importar sus datos de GPS a R y limpiarlos. <br>
- Tienen conocimientos básicos de R, si no te recomiendo [empezar por aquí](https://miriamlerma.netlify.app/posts/2021-03-01-introar/). <br>
  
---

class:center,middle

## 1. Importar datos a R

Para esta parte necesitas saber instalar paquetes, si necesitas recordar como hacerlo, te recomiendo [empezar por aquí](https://miriamll.github.io/Curso_CIAD/Clase1Parte2).

---

### 1.2. Paquetes


Cargar el paquete tidyverse
```{r, message=FALSE, warning=FALSE}
#install.packages(tidyverse)
#install.packages(here)
library(tidyverse)
library(here)
```

Define carpeta ya sea con ruta relativa (usando here) o absoluta (poniendo toda la ruta), si necesitas mas información de como escribir tus rutas [ve aqui](https://miriamll.github.io/Curso_CIAD/Clase4Parte1#1).
```{r}
DatosFolder<-'C://Users//Lerma//Documents//4Cursos//1Bobos//ClaseTracking//01Datos' #tienes que cambiar la ruta por la ruta donde descargaste tus archivos
DatosFolder<-here("01Datos") #tienes que haber creado una carpeta donde tienes tus archivos
```

---

### 1.3. Manualmente

Normalmente los dispositivos registran datos en csv.

Para cargarlos manualmente: esquina superior derecha. <br>
Import Dataset.  

```{r echo=FALSE, out.height=350}
knitr::include_graphics("https://raw.githubusercontent.com/MiriamLL/Curso_CIAD/main/Figuras/ImportarBoton.jpg")
```

---
### 1.3. Formato txt

Para cargarlos con código de R, la función read_tvs se usa cuando los valores están separados por **tabs/espacios**.  

```{r, message=FALSE}
GPS01_txt<-read_tsv(paste0(DatosFolder,("//GPS01.txt")))
```

```{r}
head(GPS01_txt)
```

---

### 1.4. Formato xlsx

Para importar datos desde excel, hay que cargar la librería readxl
```{r, eval=FALSE}
library("readxl")
```

La funcion read_excel se usa para cargar archivos de excel.
```{r, eval=FALSE}
GPS01_excel<- read_excel(paste0(DatosFolder,("//GPS01.xlsx")))
```

```{r, eval=FALSE}
head(GPS01_excel)
```

---

### 1.5. Multiples archivos

Para cargar múltiples archivos, te recomiendo definir la carpeta donde tienes tus archivos y pedirle a R que te los enliste.

Define tu carpeta.
```{r}
# Toda la ruta de la carpeta
DatosFolder<-'C://Users//Lerma//Documents//4Cursos//1Bobos//ClaseTracking//01Datos'
# Ruta relativa
DatosFolder<-here("01Datos")
```

Enlista tus archivos.
```{r}
Lista_GPS <- list.files(DatosFolder,pattern="*.csv",full.names=TRUE)
```
Importante: tu debes definir si son txt, xlsx o csvs.

---

### 1.5. Leer multiples archivos

Esta función sirve para leer todos los archivos.
```{r, message=FALSE}
Lista_GPS <- lapply(Lista_GPS,read_csv)
```
Si quieres descargar los archivos de prueba [ve aqui](https://github.com/MiriamLL/Curso_tracking/tree/main/01Datos).

Para poder identificar los diferentes GPS, antes de unir todo tus datos deberás agregar un ID.

---

### 1.6. Agregar ID

Para agregar ID en tus data frames, existen varias opciones, aquí enlisto tres de ellas.

**Opción 1:**  
Uno por uno
```{r}
GPS01<-Lista_GPS[1]
```

```{r}
GPS01$ID<-'GPS01'
```

Solo recomendable para listas pequeñas.
```{r}
GPS02<-Lista_GPS[2]
GPS02$ID<-'GPS02'
```

---

### 1.6. Usando lista

**Opción 2:**  
Usando el nombre del archivo
```{r}
Nombres_archivos<-list.files(DatosFolder,pattern="*.csv",full.names=FALSE)
IDs<-gsub('.csv','',Nombres_archivos)
```

Agrega una columna a cada elemento de la lista.
```{r}
for( i in seq_along(Lista_GPS)){
  Lista_GPS[[i]]$IDs <- IDs[i]
}
```

---

### 1.6. Especificando nombres

**Opción 3:**  
Creando vector con los nombres.
```{r}
IDs<-c("ID01","ID02","ID03","ID04","ID05","ID06","ID07","ID08","ID09","ID10")
```

Agrega el nombre definido en ID en orden a los elementos de la lista.
```{r}
for( i in seq_along(Lista_GPS)){
  Lista_GPS[[i]]$IDs <- IDs[i]
}
```


---

### 1.7. Unir multiples archivos

Esta función te permite unirlos.
```{r}
Todos_GPS <- do.call("rbind",Lista_GPS)
```
Pero **ojo** el numero de columnas y nombres de las columnas debe ser el mismo.

```{r}
Todos_GPS
```


---

class:center,middle

## 2. Recortar
Para esta parte puedes necesitar algunos básicos de como manipular data frames en R, si necesitas más información [ve aquí](https://miriamll.github.io/Curso_CIAD/Clase3Parte2#1).

---

### 2.1. Hora inicio y hora final.

Supongamos que el GPS01, se coloco a las 18:10:00 del 02/11/2017 y se retiro a las 14:10:00 el 05/11/2017.

Se debe convertir la hora de inicio y la hora final a formato día y hora.
```{r}
HoraInicio<-'02/11/2017 18:10:00'
HoraInicio<-as.POSIXct(strptime(HoraInicio, "%d/%m/%Y %H:%M:%S"), "GMT") 
```

```{r}
HoraFinal<-'05/11/2017 14:10:00'
HoraFinal<- as.POSIXct(strptime(HoraFinal, "%d/%m/%Y %H:%M:%S"), "GMT") 
```

Se deben unir las columnas de fecha y tiempo en nuestros datos de GPS y convertir al formato POSIXct para que R entienda que son hora y día.
```{r}
GPS01_txt$tStamp<-paste(GPS01_txt$DateGMT,GPS01_txt$TimeGMT)
GPS01_txt$tStamp1<-as.POSIXct(strptime(GPS01_txt$tStamp, "%d/%m/%Y %H:%M:%S"),  "GMT")
```

---

### 2.2. Eliminar periodos dentro de nuestros datos

Después se puede seleccionar solo el periodo que nos interesa.  
Yo utilice la función mutate, que agregara una columna con Y o N,  siendo _N_ el periodo que queremos eliminar.  
No es necesario crear esa columna, se puede usar **filter** directo pero a mí me gusta verificar primero.  
```{r}
GPS01<-mutate(GPS01_txt, Tracking = ifelse(GPS01_txt$tStamp1 >= HoraInicio & GPS01_txt$tStamp1 <= HoraFinal, "Y","N"))
```

Después filtre solo el periodo que me interesa. 

**Opción 1**: usando la función **filter**
```{r}
GPS01<-GPS01 %>% 
  filter(Tracking=='Y')
```

**Opción 2**: usando la función **subset**
```{r}
GPS01<-subset(GPS01,GPS01$Tracking=='Y')
```
Nota que el numero de observaciones se reduce.  

---

class:center,middle

## 3. Graficar
Para los básicos de como realizar gráficos en R [ve aquí](https://miriamll.github.io/Curso_CIAD/Clase2#1).

---

### 3.1. Trayectorias individuo

Para graficar un solo individuo.
```{r, out.width="40%"}
ggplot(data = GPS01, aes(x = Latitude, y = Longitude)) +
  geom_path()+
  theme_bw()
```

---

### 3.2. Trayectorias individuales
Para graficar varios individuos
```{r, out.width="40%"}
ggplot(data = Todos_GPS, aes(x = Latitude, y = Longitude)) +
  geom_path(aes(group = IDs, color = IDs),size=2)+
  theme_bw()
```


---

## 4. Exportar 

Seleccionar la carpeta.
```{r}
library(here)
DatosFolder<-here::here("01Datos")
```

Exportar el nuevo data frame. 
```{r}
write_csv(
  Todos_GPS,
  file=paste0(DatosFolder,'/Todos_GPS.csv'))
```

---

## 5. Contacto

- Para dudas, comentarios y sugerencias:  
Escríbeme a miriamjlerma@gmail.com

- Este material esta libre y se encuentra en mi [github](https://github.com/MiriamLL/Curso_tracking/blob/main/Parte1.Rmd).

- Si quieres dar créditos puedes usar:
Lerma M, 2021. Importar datos de GPS. Próximamente con zenodo. 

- Los datos de prueba vienen de la publicación:
Lerma M, Dehnhard N, Luna-Jorquera G, Voigt CC, Garthe SS (2020) Breeding stage, not sex, affects foraging characteristics in masked boobies at Rapa Nui. Behavioral ecology and sociobiology 74: 149 [OpenAccess](https://link.springer.com/article/10.1007/s00265-020-02921-1)
